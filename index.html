<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EX - Dashboard della citt√†</title>
  </head>
  <body>
    <h1><b>EX - Dashboard della citt√†</b></h1>
    <h2><b>Consegna</b></h2>

    <p>
      In questo esercizio, utilizzerai
      <b>Promise.all()</b>
      per creare la funzione
      <b>getDashboardData(query),</b>
      che accetta una citt√† come input e recupera simultaneamente:
    </p>

    <ul>
      <li>
        Nome completo della citt√† e paese da
        <b> /destinations?search=[query]</b>
        (result.name, result.country, nelle nuove propriet√† city e country).
      </li>
      <br />
      <li>
        Il meteo attuale da <b>/weathers?search={query}</b> (result.temperature
        e result.weather_description nella nuove propriet√† temperature e
        weather).
      </li>
      <br />
      <li>
        Il nome della aeroporto principale da <b>/airports?search={query}</b>
        (result.name nella nuova propriet√† airport).
      </li>
      <br />
    </ul>
    <p>
      Utilizzerai
      <b>Promise.all()</b>
      per eseguire queste richieste in parallelo e poi restituirai un oggetto
      con i dati aggregati.
    </p>
    <h2>
      <b
        >Attenzione: le chiamate sono delle ricerche e ritornano una array
        ciascuna, di cui devi prendere il primo risultato (il primo
        elemento).</b
      >
    </h2>
    <h3><b>Note del docente</b></h3>
    <p>
      Scrivi la funzione
      <b>getDashboardData(query),</b>
      che deve:
      <br />
      <br />
    </p>
    <ul>
      <li>Essere asincrona (<b>async</b>).</li>
      <br />
      <li>
        Utilizzare <b>Promise.all()</b> per eseguire pi√π richieste in parallelo.
      </li>
      <br />
      <li>
        Restituire una <b>Promise</b> che risolve un oggetto contenente i dati
        aggregati.
      </li>
      <br />
      <li>Stampare i dati in console in un messaggio ben formattato.</li>
      <br />
      <li>Testa la funzione con la query "london"</li>
    </ul>
    <h4><b>Esempio di utilizzo </b></h4>
    <p>
      getDashboardData('london') <br />
      .then(data =<!-- ricorddarsi che √® => -->
      <br />{ <br />
      console.log('Dasboard data:', data);<br />
      console.log( `${data.city} is in ${data.country}.\n` + <br />
      `Today there are ${data.temperature} degrees and the weather is
      ${data.weather}.\n`+ <br />
      `The main airport is ${data.airport}.\n` <br />
      ); <br />
      }) <br />
      .catch(error =<!-- ricorddarsi che √® => -->
      console.error(error));
    </p>

    <h4><b>Esempio di output atteso</b></h4>
    <p>
      // Risposta API <br />
      { <br />
      city: "London", <br />
      country: "United Kingdom", <br />
      temperature: 18, <br />
      weather: "Partly cloudy", <br />
      airport: "London Heathrow Airport" <br />
      } <br />

      // Output in console London is in United Kingdom. <br />
      Today there are 18 degrees and the weather is Partly cloudy. <br />
      The main airport is London Heathrow Airport.
    </p>
    <br />

    <h2><b>üéØ Bonus 1 - Risultato vuoto</b></h2>
    <p>
      <b>Se la array di ricerca √® vuoto,</b>
      invece di far fallire l'intera funzione, semplicemente i dati relativi a
      quella chiamata verranno settati a null e la frase relativa non viene
      stampata. Testa la funzione con la query ‚Äúvienna‚Äù (non trova il meteo).
    </p>

    <p>
      Risposta API <br />
      {
      <br />
      city: "Vienna", <br />
      country: "Austria", <br />
      temperature: null, <br />
      weather: null, <br />
      airport: "Vienna International Airport"<br />
      } <br />
      <br />

      Output in console <br />

      Vienna is in Austria. <br />
      The main airport is Vienna International Airport.
    </p>
    <h2><b>üéØ Bonus 2 - Chiamate fallite</b></h2>
    <p>
      Attualmente, se una delle chiamate fallisce, **Promise.all()** rigetta
      l'intera operazione.
      <br />
      <br />Modifica `getDashboardData()` per usare **Promise.allSettled()**, in
      modo che:
      <br />
      <br />
    </p>
    <ul>
      <li>
        <b>Se una chiamata fallisce,</b> i dati relativi a quella chiamata
        verranno settati a null.
      </li>
      <br />
      <li>
        Stampa in console un messaggio di errore per ogni richiesta fallita.
      </li>
      <br />
      <li>
        Testa la funzione con un link fittizio per il meteo (es.
        https://www.meteofittizio.it).
      </li>
    </ul>

    <script src="snack-promise-all.js"></script>
  </body>
</html>
